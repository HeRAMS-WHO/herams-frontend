"use strict";window.appVersion="v1.0",angular.module("app-herams",["ui.router","ui.bootstrap"]);var CONFIG={esriHTTP:{start:"https://extranet.who.int/maps/rest/services/WHE_BASEMAP/GLOBAL_ADM/MapServer/4/query?where=ADM0_NAME+IN+%28%27",end:"%27%29&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=ADM0_NAME%2C+ISO_2_CODE&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json"},home:{layersOpacity:.6,dfltColors:{layer_stroke_color:"#7b7b7b",layer_stroke_weight:1.5,layer_fill_color:"#ffffff"},centroidRadius:15},overview:{map:{zoom:5.4,lat:9.082,long:8.6753,basemaps:["https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"],layers:[{name:"Nigeria"}]}},charts:{common:{title:{align:"left"},exporting:{enabled:!1},yAxis:[{labels:{enabled:!1},title:{enabled:!1}}]},bar:{chart:{type:"bar",spacing:[0,0,0,0],marginRight:25,marginLeft:130,marginBottom:50,backgroundColor:"rgba(255, 255, 255, 0.0)",style:{fontFamily:"'Source Sans Pro',sans-serif"}},legend:{enabled:!1},tooltip:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){return"<b>"+this.point.y+"</b>"},positioner:function(e,t,o){return{x:o.plotX+100,y:o.plotY-3}}},xAxis:{categories:["placeholder 1","placeholder 2","placeholder 3","placeholder 4"],labels:{style:{width:"100px",fontSize:"14px"}}},plotOptions:{bar:{pointWidth:10,align:"left",dataLabels:{enabled:!0,formatter:function(){return"<b>"+this.point.custom+"</b>"},style:{fontSize:"12px",fontWeight:"bold"}}}},series:[{data:[{y:30,custom:342,color:"#dc4a8b"},{y:4,custom:167,color:"#599d22"},{y:20,custom:210,color:"#52addc"},{y:10,custom:62,color:"#006958"}]}]},stacked:{chart:{type:"bar",marginLeft:0,marginRight:0,spacing:[0,0,0,0],backgroundColor:"rgba(255, 255, 255, 0.0)",style:{fontFamily:"'Source Sans Pro',sans-serif"}},tooltip:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){return"<b>"+this.y+"%</b>"},positioner:function(e,t,o){var r=o.plotX-e-10,a=o.plotY-3;return{x:2<r?r:2,y:2<a?a:2}}},yAxis:[{labels:{enabled:!1},title:{enabled:!1}}],xAxis:{categories:["placeholder 1","placeholder 2","placeholder 3"],labels:{x:0,y:-6,align:"left",style:{width:"200px",fontSize:"12px"}}},plotOptions:{series:{stacking:"normal",pointWidth:6}},series:[{name:"#1 (test)",data:[50,10,5]}]},pie:{chart:{type:"pie",animation:!0,spacing:[0,0,0,0],style:{fontFamily:"'Source Sans Pro',sans-serif"}},exporting:{enabled:!1},credits:{enabled:!1},title:{text:"",align:"left"},legend:{floating:!0,maxHeight:100,verticalAlign:"top",y:100},plotOptions:{pie:{borderColor:"transparent",innerSize:"93%",enableMouseTracking:!0,dataLabels:{enabled:!1},showInLegend:!0}},tooltip:{enabled:!1},series:[{size:"100%",states:{hover:{enabled:!1}}}]},tooltip_pie:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){var e=Math.pow(10,1),t=Math.round(this.point.percentage*e)/e;return"n = "+this.point.y+"<br/><b>"+t+"%</b>"},positioner:function(e,t,o){return{x:o.plotX+10,y:o.plotY-3}}},legend_cust:{align:"left",enabled:!0,symbolRadius:0,symbolWidth:8,symbolHeight:8,marginLeft:0,spacing:[0,0,0,0]}}};angular.module("app-herams").directive("userpopover",["commonSvc",function(e){return{templateUrl:"/js/common/directives/user_popover.html",restrict:"E",replace:!0,scope:!1}}]),angular.module("app-herams").factory("commonSvc",["$state","$http","$compile","$window","$log",function(e,r,o,t,a){var n={home:ENV_VARS.host+"home",overview:ENV_VARS.host+"categories"};return{deepCopy:function(e){return $.extend(!0,{},e)},loadData:function(e,t){var o={token:tokenConfig};return t&&(o=$.extend(o,t)),r({method:"GET",url:e,params:o,headers:{"Content-Type":"application/json;charset=UTF-8"}})},isLocal:function(){return"localhost"==window.location.hostname},getWSPaths:function(e){return n[e]},home:function(){t.location="/"},gotoProject:function(e){t.location=this.isLocal?"overview.html":"/projects/"+e},showUsrProfile:function(){t.location="/user/settings/profile"},logout:function(){t.location="/site/logout"},setLoginPopover:function(t){t.logout=this.logout,t.viewProfile=this.showUsrProfile,$("#log").popover({container:$(".popover-base"),placement:"bottom",boundary:"window",content:'<span class="popover-spacer">this is a test</span>',html:!0}),$("#log").on("shown.bs.popover",function(){var e=o("<userpopover></userpopover>")(t);$(".popover-body").html(e)})},setUsrInfo:function(e,t){var o=t||{email:"hardtest@novel-t.ch",first_name:"Sam",last_name:"Petragallo"};e.usr_name=o.first_name+" "+o.last_name,e.usr_email=o.email},getWindowWdth:function(){var e=window,t=document,o=t.documentElement,r=t.getElementsByTagName("body")[0];return e.innerWidth||o.clientWidth||r.clientWidth}}}]),angular.module("app-herams").service("esriSvc",["$timeout","$log","$http","LayerPopupSvc",function(e,t,o,h){var m;function r(d,f){var e,t=(e=d.name,CONFIG.esriHTTP.start+e+CONFIG.esriHTTP.end);o({method:"GET",url:t,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){var t,o,r,a,n,i,s,l,c,p,u;t=e.data.features,o=d,r=f,a={type:"FeatureCollection"},n=t.map(function(e){return ArcgisToGeojsonUtils.arcgisToGeoJSON(e)}),a.features=n,i=a,s=o,c=(l=r)||CONFIG.home.dfltColors.layer_stroke_color,p=l||CONFIG.home.dfltColors.layer_fill_color,u=L.geoJSON(i,{style:{color:c,weight:CONFIG.home.dfltColors.layer_stroke_weight,fillOpacity:CONFIG.home.layersOpacity,fillColor:p}}).addTo(m),null!=s.stats&&h.addPopup(m,u,s)})}return{getEsriShape:function(e,t,o){m=e,r(t,o)}}}]),angular.module("app-herams").service("LayerPopupSvc",["$timeout","$compile","$log","commonSvc",function(n,i,e,o){return{addPopup:function(r,e,a){if(e.on("mouseover",function(e){if($(".entry-popup.layer"+void 0).length<=0){var t='<entry-popup countryname="'+a.name+'"></entry-popup>',o=L.popup({className:"entry-popup layer"+void 0,closeButton:!0}).setLatLng([a.geodata.lat,a.geodata.long]).setContent(t).openOn(r);n(function(){var e=angular.element(".home").scope();i(o._contentNode)(e)})}}),null!=a.pid){var t=a.pid;e.on("click",function(e){o.gotoProject(t)})}}}}]),angular.module("app-herams").controller("MainCtrl",["$scope","$compile","$log","$timeout","commonSvc","HFMapSvc","chartsSvc",function(r,a,n,i,s,l,c){function e(){$(".partners-list-grp").hide(),$(".partners-list").removeClass("fullHeight")}function p(){for(var e=0;e<r.charts.length;e++){$("#chart"+(e+1)).empty()}c.destroyCharts(),c.setCharts(r.charts),l.refreshLayout()}function t(o){r.mapdata={},r.charts={},r.tables=[],$(".main-content").empty(),c.destroyCharts(),r.catNameSelect=o.name,r.catIDSelect=o.id;var e=function(e){var t;switch(e){case"layout14":t="<layout14></layout14>";break;case"layout13":t="<layout13></layout13>"}return t}(o.layout),t=a(e)(r);$(".main-content").html(t),$(".main-content").hide(),$(".loading").show(),i(function(){var e,t;e=o.ws_chart_url,t=function(){var e;e=o.ws_map_url,s.loadData(e).then(function(e){r.mapdata=e.data.results,l.createMap("mapid-wkspace",r.mapdata)}).catch(function(e){n.info("Error loading Map Data: ",e)}).then(function(){$(".loading").hide(),$(".main-content").show(),$(window).off("resize",p),$(window).resize(p),i(function(){p()},100)})},s.loadData(e).then(function(e){for(var t in r.charts=e.data.stats?e.data.stats:e.data,r.charts)"table"==r.charts[t].type&&r.tables.push(u(r.charts[t]))}).catch(function(e){n.info("Error loading Charts Data: ",e)}).then(function(e){t()})},1500)}function u(e){var t={},o=e.rows;for(var r in t.name=e.name,t.cols=e.columns,t.rows=[],o){var a=[];for(var n in o[r])a.push(o[r][n]);t.rows.push(a)}return t}r.charts={},r.categories=[],r.catIDSelect=null,r.catNameSelect=null,r.mapdata={},r.tables=[],r.filters=[],r.date=new Date,r.home=function(){s.home()},s.loadData(s.getWSPaths("overview")).then(function(e){n.info("success: ",e.data.results),r.categories=e.data.results.categories,s.setUsrInfo(r,e.data.results.userinfo),s.setLoginPopover(r)}).catch(function(e){n.info("There has been an error Overview Data")}).then(function(e){s.loadData("config/filters.json").then(function(e){r.filters=e.data.results.filters}).catch(function(e){n.info("There has been an error loading Filters")}).then(function(e){n.info("load filters finally")}),t(r.categories[0])}),r.launchLayout=t,$(".partners-list-btn").click(function(){$(".partners-list-grp").show(),$(".partners-list").addClass("fullHeight"),$(".partners-list-cache").click(function(){$(".partners-list-grp").hide(),$(".partners-list").removeClass("fullHeight")})}),$(window).scroll(e)}]).directive("layout14",function(){return{templateUrl:"/js/overview/directives/layouts/layout_1_4.html",restrict:"E",replace:!0}}).directive("layout13",function(){return{templateUrl:"/js/overview/directives/layouts/layout_1_3.html",restrict:"E",replace:!0}}).directive("datavizTable",function(){return{templateUrl:"/js/overview/directives/dataviz/dataviz-table.html",restrict:"E",replace:!0}}),angular.module("app-herams").directive("hfmap",["$log",function(e){return{templateUrl:"/js/overview/directives/hf-map.html",restrict:"E",replace:!0,scope:!0,link:function(o){o.legend=[],o.$watch("mapdata",function(e){if(e.config)for(var t in e.config.legend)o.legend.push(e.config.legend[t])})}}}]),angular.module("app-herams").factory("chartsSvc",["$log","commonSvc",function(e,n){var t=[];function r(u,d){var e=new Highcharts.Chart(function(e,t){if("stacked"==t.type||"bar"==t.type){var o=n.deepCopy(CONFIG.charts.common),r=$.extend(n.deepCopy(o),CONFIG.charts.stacked),a=null!=t.total?t.title+'<span class="chart-title-total"> ('+t.total+")</span>":t.title;r.title.useHTML=!0,r.title.text=a,r.xAxis.categories=t.labels,r.series=t.series,"stacked"==t.type&&(r.colors=t.colors)}else o=n.deepCopy(CONFIG.charts.common),(r=$.extend(n.deepCopy(o),CONFIG.charts.pie)).title.text=t.title,r.tooltip=CONFIG.charts.tooltip_pie,r.series[0].data=t.data;return r.chart.renderTo=e,r.legend=CONFIG.charts.legend_cust,r}(u,d),function(e){var t,o,r,a,n,i,s,l,c,p;"pie"==d.type?(s=e,l=d.total,c='<span class="pieChartCenterTxt">'+l+"</span>",p=s.plotTop+.5*s.plotHeight,$(s.renderTo).append(c),(c=$(s.renderTo).find(".pieChartCenterTxt")).css("top",p),n=e,i=d.total,$(n.series[0].data).each(function(e,t){t.legendItem.on("click",function(){var e;t.sliced?i+=t.y:i-=t.y,t.slice(!t.sliced),e=i,$(n.renderTo).find(".pieChartCenterTxt").html(e)})})):"stacked"==d.type&&(t=e,o=u,r=$("#"+o).innerWidth(),a=$("#"+o).innerHeight()-30,t.setSize(r,a))});t.push(e)}return{setCharts:function(e){for(var t=0;t<e.length;t++){var o="chart"+(t+1);"table"!=e[t].type&&r(o,e[t])}},destroyCharts:function(){0<t.length&&function(){for(var e=0;e<t.length;e++)t[e].destroy();t=[]}()}}}]),angular.module("app-herams").service("HFMapSvc",["$rootScope","$state","$timeout","$window","$compile","$log","esriSvc","commonSvc",function(e,t,o,r,a,n,i,s){var l,c,p;return{createMap:function(e,t){for(var o in c=CONFIG.overview.map,(l=L.map(e)).zoomControl.setPosition("topright"),c.basemaps)L.tileLayer(c.basemaps[o]).addTo(l);i.getEsriShape(l,c.layers[0]),function(e,t){var o=t.hf_list,r=t.config.colors,a=[];for(var n in o){var i=L.divIcon({className:"herams-marker-icon",html:'<i class="fas fa-circle" style="color:'+r[o[n].type]+'"></i>'});L.marker(o[n].coord,{icon:i}).addTo(e),a.push(o[n].coord)}var s=a.length<200?a.length:200;p=new L.LatLngBounds(a.slice(0,s)),e.fitBounds(p)}(l,t),this.refreshLayout()},refreshLayout:function(){var e=$(window).height()-280;e=550<e?e:550,$(".main-content").height(e),$(".map-container").height(e);var t=$(".map-container").innerHeight();$("#mapid-wkspace").height(t),l&&l.invalidateSize(),l&&l.fitBounds(p)}}}]),angular.module("app-herams").directive("datepicker",["$log",function(e){return{templateUrl:"/js/overview/directives/filters/datepicker.html",restrict:"E",replace:!0,scope:{dt:"=date"},controller:["$scope",function(e){e.showing=!1,e.dateOptions={formatYear:"yyyy-MM-dd",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},e.togglePicker=function(){e.showing=!e.showing}}]}}]),angular.module("app-herams").directive("dropdown",["$log",function(e){return{templateUrl:"/js/overview/directives/filters/dropdown.html",restrict:"E",replace:!0,scope:{src:"@icon",value:"@value",items:"="},controller:["$scope",function(t){e.info("$scope.items: ",t.items),t.select=function(e){t.value=e}}]}}]);