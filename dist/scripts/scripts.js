var CONFIG={esriHTTP:{start:"https://extranet.who.int/maps/rest/services/WHE_BASEMAP/GLOBAL_ADM/MapServer/4/query?where=ADM0_NAME+IN+%28%27",end:"%27%29&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=ADM0_NAME%2C+ISO_2_CODE&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json"},home:{layersOpacity:.6,dfltColors:{layer_stroke_color:"#7b7b7b",layer_stroke_weight:1.5,layer_fill_color:"#ffffff"},centroidRadius:15},overview:{map:{zoom:5.4,lat:9.082,long:8.6753,basemaps:["https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"],layers:[{name:"Nigeria"}]}},charts:{common:{title:{align:"left"},exporting:{enabled:!1},yAxis:[{labels:{enabled:!1},title:{enabled:!1}}]},bar:{chart:{type:"bar",spacing:[0,0,0,0],marginRight:25,marginLeft:130,marginBottom:50,backgroundColor:"rgba(255, 255, 255, 0.0)",style:{fontFamily:"'Source Sans Pro',sans-serif"}},legend:{enabled:!1},tooltip:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){return"<b>"+this.point.y+"</b>"},positioner:function(t,e,a){return{x:a.plotX+100,y:a.plotY-3}}},xAxis:{categories:["placeholder 1","placeholder 2","placeholder 3","placeholder 4"],labels:{style:{width:"100px",fontSize:"14px"}}},plotOptions:{bar:{pointWidth:10,align:"left",dataLabels:{enabled:!0,formatter:function(){return"<b>"+this.point.custom+"</b>"},style:{fontSize:"12px",fontWeight:"bold"}}}},series:[{data:[{y:30,custom:342,color:"#dc4a8b"},{y:4,custom:167,color:"#599d22"},{y:20,custom:210,color:"#52addc"},{y:10,custom:62,color:"#006958"}]}]},stacked:{chart:{type:"bar",marginLeft:0,marginRight:0,spacing:[0,0,0,0],backgroundColor:"rgba(255, 255, 255, 0.0)",style:{fontFamily:"'Source Sans Pro',sans-serif"}},tooltip:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){return"<b>"+this.y+"%</b>"},positioner:function(t,e,a){var o=a.plotX-t-10,r=a.plotY-3;return{x:2<o?o:2,y:2<r?r:2}}},yAxis:[{labels:{enabled:!1},title:{enabled:!1}}],xAxis:{categories:["placeholder 1","placeholder 2","placeholder 3"],labels:{x:0,y:-6,align:"left",style:{width:"200px",fontSize:"12px"}}},plotOptions:{series:{stacking:"normal",pointWidth:6}},series:[{name:"#1 (test)",data:[50,10,5]}]},pie:{chart:{type:"pie",animation:!0,spacing:[0,0,0,0],style:{fontFamily:"'Source Sans Pro',sans-serif"}},exporting:{enabled:!1},credits:{enabled:!1},title:{text:"",align:"left"},legend:{floating:!0,maxHeight:100,verticalAlign:"top",y:100},plotOptions:{pie:{borderColor:"transparent",innerSize:"93%",enableMouseTracking:!0,dataLabels:{enabled:!1},showInLegend:!0}},tooltip:{enabled:!1},series:[{size:"100%",states:{hover:{enabled:!1}}}]},tooltip_pie:{backgroundColor:"rgba(66,66,74,1)",borderWidth:0,shadow:!1,style:{color:"#ffffff"},formatter:function(){var t=Math.pow(10,1),e=Math.round(this.point.percentage*t)/t;return"n = "+this.point.y+"<br/><b>"+e+"%</b>"},positioner:function(t,e,a){return{x:a.plotX+10,y:a.plotY-3}}},legend_cust:{align:"left",enabled:!0,symbolRadius:0,symbolWidth:8,symbolHeight:8,marginLeft:0,spacing:[0,0,0,0]}}};window.appVersion="v1.0",angular.module("app-herams",["ui.router","ui.bootstrap"]),angular.module("app-herams").factory("commonSvc",["$state","$http","$compile","$window","$log",function(t,o,a,e,r){var n={home:ENV_VARS.host+"home",overview:ENV_VARS.host+"categories"};return{deepCopy:function(t){return $.extend(!0,{},t)},loadData:function(t,e){var a={token:tokenConfig};return e&&(a=$.extend(a,e)),o({method:"GET",url:t,params:a,headers:{"Content-Type":"application/json;charset=UTF-8"}})},isLocal:function(){return"localhost"==window.location.hostname},getWSPaths:function(t){return n[t]},home:function(){e.location="/"},gotoProject:function(t){e.location=this.isLocal?"overview.html":"/projects/"+t},showUsrProfile:function(){e.location="/user/settings/profile"},logout:function(){e.location="/site/logout"},setLoginPopover:function(e){e.logout=this.logout,e.viewProfile=this.showUsrProfile,$("#log").popover({container:$(".popover-base"),placement:"bottom",boundary:"window",content:'<span class="popover-spacer">this is a test</span>',html:!0}),$("#log").on("shown.bs.popover",function(){var t=a("<userpopover></userpopover>")(e);$(".popover-body").html(t)})},setUsrInfo:function(t,e){var a=e||{email:"hardtest@novel-t.ch",first_name:"Sam",last_name:"Petragallo"};t.usr_name=a.first_name+" "+a.last_name,t.usr_email=a.email},getWindowWdth:function(){var t=window,e=document,a=e.documentElement,o=e.getElementsByTagName("body")[0];return t.innerWidth||a.clientWidth||o.clientWidth}}}]),angular.module("app-herams").service("esriSvc",["$timeout","$log","$http","LayerPopupSvc",function(t,e,a,m){var f;function o(p,h){var t,e=(t=p.name,CONFIG.esriHTTP.start+t+CONFIG.esriHTTP.end);a({method:"GET",url:e,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){var e,a,o,r,n,i,s,l,c,u,d;e=t.data.features,a=p,o=h,r={type:"FeatureCollection"},n=e.map(function(t){return ArcgisToGeojsonUtils.arcgisToGeoJSON(t)}),r.features=n,i=r,s=a,c=(l=o)||CONFIG.home.dfltColors.layer_stroke_color,u=l||CONFIG.home.dfltColors.layer_fill_color,d=L.geoJSON(i,{style:{color:c,weight:CONFIG.home.dfltColors.layer_stroke_weight,fillOpacity:CONFIG.home.layersOpacity,fillColor:u}}).addTo(f),null!=s.stats&&m.addPopup(f,d,s)})}return{getEsriShape:function(t,e,a){f=t,o(e,a)}}}]),angular.module("app-herams").controller("HomeCtrl",["$scope","commonSvc","$log","$http",function(o,r,e,t){var n=!1;o.homedata={},o.statuses=[],o.init=function(){return r.loadData(r.getWSPaths("home")).then(function(t){o.homedata=t.data.results,r.setUsrInfo(o,o.homedata.userinfo),r.setLoginPopover(o);var e=o.homedata.config.statuses;for(var a in e)o.statuses.push(e[a]);$(".collapse-left-content").click(function(){$(".menu-entry").addClass("reduced"),$(".map-entry").addClass("fullscreen"),n=!n,o.$broadcast("collapse-click",{collapsed:n})}),$(".expand-left-content").click(function(){$(".menu-entry").removeClass("reduced"),$(".map-entry").removeClass("fullscreen"),n=!n,o.$broadcast("collapse-click",{collapsed:n})}),$(".loading").hide()}).catch(function(t){e.info("There has been an error Home Data")}).then(function(t){})}}]),angular.module("app-herams").directive("entryPopup",["$log","commonSvc",function(t,r){function s(t){var e,a,o="";for(var r in t)o+=(e=t[r].label,a=t[r].color,-1==e.indexOf("N/A")?"<div><i class='fas fa-circle' style='color:"+a+"'></i>"+e+"</div>":"<div style='text-align:center;width:72px;'>"+e+"</div>");return o}function l(t){var e,a,o=(e=t,(a=r.deepCopy(CONFIG.charts.pie)).chart.margin=[0,0,0,0],a.series[0].data=e,a);return o.chart.backgroundColor="#42424b",o.chart.height=102,o.chart.width=102,o}return{templateUrl:"/js/home/directives/entry-popups.html",restrict:"E",replace:!0,scope:{countryname:"@"},controller:["$scope",function(t){}],link:function(t){var e=function(t,e){for(var a in t)if(t[a].name==e)return t[a]}(t.$parent.homedata.layers,t.countryname);t.data=e.stats;var a,o,r=l(e.stats.charts[0].data),n=l(e.stats.charts[1].data),i=l(e.stats.charts[2].data);o=function(){$("charts-percents:nth-child(1)").css("display","block")},(a=r).plotOptions.pie.events={},a.plotOptions.pie.events.afterAnimate=o(),$("#indic1-chart").highcharts(r),$("#indic2-chart").highcharts(n),$("#indic3-chart").highcharts(i),$("#chart1-legend").html(s(e.stats.charts[0].legend)),$("#chart2-legend").html(s(e.stats.charts[1].legend)),$("#chart3-legend").html(s(e.stats.charts[2].legend)),-1!=e.stats.charts[2].legend[0].label.indexOf("N/A")&&$(".charts-icons>div:nth-child(3)").css("opacity",.3)}}}]),angular.module("app-herams").directive("homemap",["MainMapSvc","$timeout","$log",function(r,t,e){var n;function i(){}return{templateUrl:"/js/home/directives/home-map.html",restrict:"E",replace:!0,scope:{mapdata:"="},controller:["$scope",function(t){}],link:function(o,t,e){o.$watch("mapdata",function(t){if(t.config){n=r.createMainMap("mapid",t.config),o.$on("collapse-click",i),$(window).resize(i);var e=t.config.statuses,a=t.layers;r.addcircleMarkerToMainMap(n,a,e)}})}}}]),angular.module("app-herams").service("MainMapSvc",["$rootScope","$state","$timeout","$window","$compile","$log","commonSvc","esriSvc","LayerPopupSvc",function(t,e,a,o,r,n,i,s,l){return{createMainMap:function(t,e){var a=L.latLng(87.875,-30.535486),o=L.latLng(-71.1879,160.769861),r=L.latLngBounds(a,o),n=L.map(t,{maxBounds:r,minZoom:e.zoom_options.minZoom,maxZoom:e.zoom_options.maxZoom,zoomDelta:e.zoom_options.zoomDelta,center:[40.056073,78.883203],zoom:3});for(var i in n.fitBounds(r),n.zoomControl.setPosition("bottomright"),e.basemaps)L.tileLayer(e.basemaps[i]).addTo(n);return n},addLayersToMainMap:function(t,e,a){for(var o in e){var r=a[e[o].status];s.getEsriShape(t,e[o],r.color)}},addcircleMarkerToMainMap:function(t,e,a){for(var o in e){var r=a[e[o].status],n=L.latLng(e[o].geodata.lat,e[o].geodata.long),i=L.circleMarker(n,{radius:CONFIG.home.centroidRadius,fillColor:r.color,color:e[o].available?"white":r.color,weight:e[o].available?3:0,opacity:1,fillOpacity:CONFIG.home.layersOpacity,className:e[o].stats?"":"disable-cursor"}).addTo(t);e[o].available&&(i.on("mouseover",function(t){t.target.setStyle({radius:CONFIG.home.centroidRadius+3,fillOpacity:1})}),i.on("mouseout",function(t){t.target.setStyle({radius:CONFIG.home.centroidRadius,fillOpacity:CONFIG.home.layersOpacity})})),null!=e[o].stats&&l.addPopup(t,i,e[o])}}}}]),angular.module("app-herams").controller("MainCtrl",["$scope","$compile","$log","$timeout","commonSvc","HFMapSvc","chartsSvc",function(o,r,n,i,s,l,c){function t(){$(".partners-list-grp").hide(),$(".partners-list").removeClass("fullHeight")}function u(){for(var t=0;t<o.catdata.length;t++){$("#chart"+(t+1)).empty()}c.destroyCharts(),c.setCharts(o.catdata),l.refreshLayout()}function e(a){o.mapdata={},o.catdata={},o.tableData=[],$(".main-content").empty(),c.destroyCharts(),o.catNameSelect=a.name,o.catIDSelect=a.id;var t=function(t){var e;switch(t){case"layout14":e="<layout14></layout14>";break;case"layout13":e="<layout13></layout13>"}return e}(a.layout),e=r(t)(o);$(".main-content").html(e),$(".main-content").hide(),$(".loading").show(),i(function(){var t,e;t=a.ws_chart_url,e=function(){var t;t=a.ws_map_url,s.loadData(t).then(function(t){o.mapdata=t.data.results,l.createMap("mapid-wkspace",o.mapdata)}).catch(function(t){n.info("Error loading Map Data: ",t)}).then(function(){$(".loading").hide(),$(".main-content").show(),$(window).off("resize",u),$(window).resize(u),i(function(){u()},100)})},s.loadData(t).then(function(t){for(var e in o.catdata=t.data.stats?t.data.stats:t.data,o.catdata)"table"==o.catdata[e].type&&o.tableData.push(d(o.catdata[e]))}).catch(function(t){n.info("Error loading Charts Data: ",t)}).then(function(t){e()})},1500)}function d(t){var e={},a=t.rows;for(var o in e.name=t.name,e.cols=t.columns,e.rows=[],a){var r=[];for(var n in a[o])r.push(a[o][n]);e.rows.push(r)}return e}o.categories=[],o.catIDSelect=null,o.catNameSelect=null,o.mapdata={},o.catdata={},o.tableData=[],o.date=new Date,o.home=function(){s.home()},s.loadData(s.getWSPaths("overview")).then(function(t){n.info("success: ",t.data.results),o.categories=t.data.results.categories,s.setUsrInfo(o,t.data.results.userinfo),s.setLoginPopover(o)}).catch(function(t){n.info("There has been an error Overview Data")}).then(function(t){e(o.categories[0])}),o.launchLayout=e,$(".partners-list-btn").click(function(){$(".partners-list-grp").show(),$(".partners-list").addClass("fullHeight"),$(".partners-list-cache").click(function(){$(".partners-list-grp").hide(),$(".partners-list").removeClass("fullHeight")})}),$(window).scroll(t)}]).directive("layout14",["$timeout","$log",function(t,e){return{templateUrl:"/js/overview/directives/layouts/layout_1_4.html",restrict:"E",replace:!0}}]).directive("layout13",["$timeout","$log",function(t,e){return{templateUrl:"/js/overview/directives/layouts/layout_1_3.html",restrict:"E",replace:!0}}]).directive("datavizTable",function(){return{templateUrl:"/js/overview/directives/dataviz/dataviz-table.html",restrict:"E",replace:!0}}),angular.module("app-herams").directive("hfmap",["$log",function(t){return{templateUrl:"/js/overview/directives/hf-map.html",restrict:"E",replace:!0,scope:!0,link:function(a){a.legend=[],a.$watch("mapdata",function(t){if(t.config)for(var e in t.config.legend)a.legend.push(t.config.legend[e])})}}}]),angular.module("app-herams").service("HFMapSvc",["$rootScope","$state","$timeout","$window","$compile","$log","esriSvc","commonSvc",function(t,e,a,o,r,n,i,s){var l,c,u;return{createMap:function(t,e){for(var a in c=CONFIG.overview.map,(l=L.map(t)).zoomControl.setPosition("topright"),c.basemaps)L.tileLayer(c.basemaps[a]).addTo(l);i.getEsriShape(l,c.layers[0]),function(t,e){var a=e.hf_list,o=e.config.colors,r=[];for(var n in a){var i=L.divIcon({className:"herams-marker-icon",html:'<i class="fas fa-circle" style="color:'+o[a[n].type]+'"></i>'});L.marker(a[n].coord,{icon:i}).addTo(t),r.push(a[n].coord)}var s=r.length<200?r.length:200;u=new L.LatLngBounds(r.slice(0,s)),t.fitBounds(u)}(l,e),this.refreshLayout()},refreshLayout:function(){var t=$(window).height()-280;t=550<t?t:550,$(".main-content").height(t),$(".map-container").height(t);var e=$(".map-container").innerHeight();$("#mapid-wkspace").height(e),l&&l.invalidateSize(),l&&l.fitBounds(u)}}}]);